<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			*{margin: 0;padding: 0;}
			 #div1{ background: url(img/m1.jpg) no-repeat;}
			#div2,#div1{width: 310px;height: 310px;overflow: hidden;float: left;margin: 20px;position: relative;}
			#div2{display: none;}
			#span{width: 100px;height: 100px;position: absolute;left: 0;top: 0;background: yellow;opacity: 0.5;display: none;}
			img{position: absolute;left: 0;top: 0;}
		</style>
		<script>
			window.onload=function(){
				var oDiv1=document.getElementById('div1');
				var oDiv2=document.getElementById('div2');
				var oSpan=document.getElementById('span');
				var oImg=document.getElementById('img');
				
				
				var maxLeft=0;
				var maxTop=0;
				var maxImgLeft=0;
				var maxImgTop=0;
				
				oDiv1.onmouseover=function(){
					oDiv2.style.display='block';
					oSpan.style.display='block'
					maxLeft=oDiv1.offsetWidth-oSpan.offsetWidth
					maxTop=oDiv1.offsetHeight-oSpan.offsetHeight
					maxImgLeft=oImg.offsetWidth-oDiv2.offsetWidth
					maxImgTop=oImg.offsetHeight-oDiv2.offsetHeight
				}
				
				oDiv1.onmouseout=function(){
					oDiv2.style.display='none';
					oSpan.style.display='none';
				}
				
				oDiv1.onmousemove=function(ev){
					var oEvent=ev || event;
					var left=oEvent.clientX-oDiv1.offsetLeft-oSpan.offsetWidth/2;
					var top=oEvent.clientY-oDiv1.offsetTop-oSpan.offsetHeight/2;
					
					if(left<0)
					{
						left=0;
					}
					 if(left>maxLeft)
					{
						left=maxLeft;
					}
					
					if(top<0)
					{
						top=0;
					}
					if(top>maxTop)
					{
						top=maxTop;
					}
					
					oSpan.style.left=left+'px';
					oSpan.style.top=top+'px';
					
					oImg.style.left=-left/maxLeft*maxImgLeft+'px';
					oImg.style.top=-top/maxTop*maxImgTop+'px';
				}
			};
		</script>
	</head>
	<body>
		<div id="div1">
			<span id="span"></span>
		</div>
		<div id="div2">
			<img src="img/b1.jpg" id="img" />
		</div>
	</body>
</html>
